#!/usr/bin/perl -w

use strict;

BEGIN   { $| = 1; print "1..4\n"; }
END     { print "not ok 1\n" unless $::XBaseindexloaded; }


BEGIN { print "Load the module: use XBase::Index\n"; }

use XBase::Index;
$::XBaseindexloaded = 1;

print "ok 1\n";

my $dir = ( -d "t" ? "t" : "." );

my $index = new XBase::Index "$dir/ndx-char.ndx" or do
	{
	print $XBase::Base::errstr;
	print "not ok 2\n";
	exit;
	};
print "ok 2\n";

$index->prepare_select or print $index->errstr, 'not ';
print "ok 3\n";

my $got = '';
while (my @data = $index->fetch())
	{ $got .= substr($data[0], 0, 10) . $data[1] . "\n"; }

my $expected = join '', <DATA>;
if ($got ne $expected)
	{ print "Got:\n$got\nExpected:\n$expected\nnot "; }
print "ok 4\n";

__DATA__
1         4
1         20
10        1
10        11
15        7
1z        27
2         9
3         18
3a        21
4         10
4         17
4e        24
5         6
5         16
5b        22
6         3
6         15
6g        25
7         8
7         14
